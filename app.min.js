const MESSAGES={ERROR:{SELECT_GAME:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡πá‡∏≠‡∏î",DOWNLOAD_FAILED:"‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",INSTALL_FAILED:"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î",LOAD_FAILED:"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏°‡πá‡∏≠‡∏î",MOD_NOT_FOUND:"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",SELECT_FOLDER:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå",UPDATE_MOD:"‡∏û‡∏ö‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏°‡πá‡∏≠‡∏î! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"},STATUS:{DOWNLOADING_INSTALLING:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î...",INSTALL_SUCCESS:"‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"}},statusMessages=new Map([["inTranslation","‚ú® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•"],["translationPaused","üïí ‡∏û‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•"],["underReview","‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"],["updating","üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï"]]);let isInstalling=!1,modList={},selectedGameId=null;function renderProgressMessage(e){document.getElementById("progress-message").textContent=e}function isGameSelected(){return!!selectedGameId||(renderProgressMessage(MESSAGES.ERROR.SELECT_GAME),!1)}async function loadModList(){try{const e=await fetch("modlist.json");if(!e.ok)throw new Error("Network response was not ok");modList=await e.json(),renderTranslators(modList.translators)}catch(e){renderProgressMessage(MESSAGES.ERROR.LOAD_FAILED),console.error("Error loading mod list:",e)}}function renderTranslators(e){const t=document.getElementById("translator-select-container");t.innerHTML="",Object.keys(e).forEach((s=>{const n=e[s];renderMods(t,n.mods)}))}function renderMods(e,t){const s=document.createElement("div");s.classList.add("translator-mods"),e.appendChild(s),t.forEach((e=>{const t=document.createElement("div");t.classList.add("game-card"),t.dataset.game=e.id;const n=document.createElement("input");n.type="radio",n.name="game",n.value=e.id,n.style.display="none";const r=document.createElement("img");if(r.src=e.image,r.alt=e.name,r.loading="lazy",statusMessages.has(e.status)){const s=document.createElement("div");s.classList.add("status-message"),s.textContent=statusMessages.get(e.status),t.appendChild(s)}t.appendChild(n),t.appendChild(r),s.appendChild(t),t.addEventListener("click",(()=>handleModSelection(t,e)))}))}function handleModSelection(e,t){const s=document.getElementById("install-mod-btn");statusMessages.has(t.status)?(s.disabled=!0,s.title="‡∏°‡πá‡∏≠‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ"):(s.disabled=!1,s.title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î"),resetSelection(),e.classList.add("selected"),e.querySelector("input").checked=!0,selectedGameId=t.id,s.textContent=t.manual_url?"‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏°‡πá‡∏≠‡∏î":"‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î",renderProgressMessage(`‡∏°‡πá‡∏≠‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏Å‡∏°: ${t.name}`);const n=t.platform&&Array.isArray(t.platform)?t.platform.join(", "):"‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";let r=e.querySelector(".platform-label");r||(r=document.createElement("div"),r.classList.add("platform-label"),e.appendChild(r)),r.textContent=`${n}`}function resetSelection(){document.querySelectorAll(".game-card").forEach((e=>{e.classList.remove("selected"),e.querySelector("input").checked=!1}))}async function installMod(){if(isInstalling||!isGameSelected())return;const e=getSelectedMod();if(e)if(e.manual_url)window.open(e.manual_url,"_self");else try{const t=await window.showDirectoryPicker();if(!validateInstallation(t))return;isInstalling=!0,await downloadAndInstallMod(e,t),renderProgressMessage(MESSAGES.STATUS.INSTALL_SUCCESS)}catch(e){"AbortError"===e.name?renderProgressMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î"):(renderProgressMessage(MESSAGES.ERROR.INSTALL_FAILED),console.error("Error during installation:",e))}finally{isInstalling=!1}else renderProgressMessage(MESSAGES.ERROR.MOD_NOT_FOUND)}function validateInstallation(e){return selectedGameId?!!e||(renderProgressMessage(MESSAGES.ERROR.SELECT_FOLDER),!1):(renderProgressMessage(MESSAGES.ERROR.SELECT_GAME),!1)}async function downloadAndInstallMod(e,t){try{renderProgressMessage(MESSAGES.STATUS.DOWNLOADING_INSTALLING);const s=await fetch(e.url);if(!s.ok)throw new Error(MESSAGES.ERROR.DOWNLOAD_FAILED);const n=s.headers.get("Content-Length");if(!n)throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ");const r=parseInt(n,10);let a=0;const o=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${["Bytes","KB","MB","GB","TB"][t]}`},l=s.body.getReader(),d=[];for(;;){const{done:e,value:t}=await l.read();if(e)break;d.push(t),a+=t.length;const s=Math.round(a/r*100);renderProgressMessage(`‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß ${o(a)} / ${o(r)} (${s}%)`)}renderProgressMessage("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î...");const i=new Blob(d),c=await JSZip.loadAsync(i);await extractZipToDirectory(c,t)}catch(e){throw e}}async function extractZipToDirectory(e,t){const s=Object.entries(e.files),n=s.length;let r=0;const a=s.map((async([e,s])=>{const a=e.split("/");let o=t;for(let e=0;e<a.length-1;e++){const t=a[e];o=await o.getDirectoryHandle(t,{create:!0})}if(!s.dir){const e=a[a.length-1],t=await s.async("blob"),n=await o.getFileHandle(e,{create:!0}),r=await n.createWritable();await r.write(t),await r.close()}r++,renderProgressMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î... (${Math.round(r/n*100)}%)`)}));await Promise.all(a)}function getSelectedMod(){for(let e in modList.translators)for(let t of modList.translators[e].mods)if(t.id===selectedGameId)return t;return null}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("browser-support-message");"showDirectoryPicker"in window?(e.textContent="‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î üéâ",e.style.color="green"):(e.innerHTML="‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡πá‡∏≠‡∏î ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ <strong>Chrome, Edge</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>Opera</strong>",e.style.color="red")})),loadModList(),document.getElementById("install-mod-btn").addEventListener("click",installMod);